<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;">
  <title>Nexus</title>
  <link rel="stylesheet" href="styles/app.css">
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Helvetica','Arial',sans-serif; }
  </style>
  </head>
<body>
  <div class="container">
    <header class="app-header">
      <div class="app-header__main">
        <div class="app-brand">
          <h1>Nexus</h1>
          <p class="app-subtitle">Docs / Tasks workspace</p>
        </div>
        <div class="app-header__actions">
          <button id="download-console" class="btn btn-ghost">ğŸ“‹ Console Logã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
        </div>
      </div>
    </header>
    <nav class="tabs">
      <button class="tab-btn active" data-tab="docs">Docs</button>
      <button class="tab-btn" data-tab="analytics">Analytics</button>
      <button class="tab-btn" data-tab="tasks">Tasks</button>
      <button class="tab-btn" data-tab="settings">Settings</button>
    </nav>
    <main>
      <div id="docs" class="tab-content active">
        <section class="card">
          <h2>ğŸ“š Docs Navigator</h2>
          <div class="control-group hidden" id="context-select-wrap">
            <label>Context:</label>
            <select id="context-select" title="Context source">
              <option value="repo">Repo</option>
              <option value="nexus">Nexus</option>
            </select>
          </div>
          <div class="docs-mode-bar" role="toolbar">
            <div class="docs-mode-buttons">
              <button class="btn btn-secondary docs-mode-btn" data-mode="docs">Docs</button>
              <button class="btn btn-secondary docs-mode-btn" data-mode="feats">FEATs</button>
              <button class="btn btn-secondary docs-mode-btn active" data-mode="tree">Tree</button>
            </div>
            <div class="docs-mode-meta">
              <span id="docs-mode-description">Breadcrumbsã‹ã‚‰ãƒªãƒ³ã‚¯æ§‹é€ ã‚’æ¤œè¨¼ã—ã¾ã™</span>
            </div>
          </div>
          <div id="docs-mode-docs" class="docs-mode">
            <div class="docs-split">
              <div class="docs-left">
                <h3>ã‚«ãƒ†ã‚´ãƒª</h3>
                <ul id="docs-categories"></ul>
                <p class="empty-state" id="docs-categories-empty">ã‚«ãƒ†ã‚´ãƒªã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™...</p>
              </div>
              <div class="docs-middle">
                <h3>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h3>
                <ul id="docs-list"></ul>
                <p class="empty-state" id="docs-list-empty">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„</p>
              </div>
              <div class="docs-right">
                <h3>è©³ç´°</h3>
                <div id="docs-detail" class="empty-state">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’é¸æŠã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
              </div>
            </div>
          </div>
          <div id="docs-mode-feats" class="docs-mode">
            <div class="feats-toolbar">
              <input id="feat-search" type="text" placeholder="FEAT-IDã‚„ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ¤œç´¢">
              <span id="feat-dup-alert" class="status hidden"></span>
            </div>
            <div class="docs-split">
              <div class="docs-left">
                <h3>FEATs</h3>
                <ul id="feats-list"></ul>
                <p class="empty-state" id="feats-list-empty">FEATä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
              </div>
              <div class="docs-right span-2">
                <h3>è©³ç´°</h3>
                <div id="feat-detail" class="empty-state">FEATã‚’é¸æŠã—ã¦ãã ã•ã„</div>
              </div>
            </div>
          </div>
          <div id="docs-mode-tree" class="docs-mode active">
            <div class="feats-toolbar">
              <select id="tree-direction" title="Tree direction">
                <option value="downstream">Downstream (ä¸Šä½â†’ä¸‹ä½)</option>
                <option value="upstream">Upstream (ä¸‹ä½â†’ä¸Šä½)</option>
              </select>
              <button id="tree-validate" class="btn btn-primary">Validate Gates</button>
              <span id="tree-status" class="status status-info" aria-live="polite"></span>
            </div>
            <div class="docs-split">
              <div class="docs-left">
                <h3>Tree</h3>
                <div id="tree-view" class="empty-state">Treeã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™...</div>
              </div>
              <div class="docs-right span-2">
                <h3>è©³ç´°</h3>
                <div id="tree-detail" class="empty-state">ãƒãƒ¼ãƒ‰ã‚’é¸æŠã™ã‚‹ã¨ãƒªãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
                <hr/>
                <h3>Quality Gates</h3>
                <div id="gate-results" class="empty-state">Validateã‚’æŠ¼ã—ã¦Gateçµæœã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†</div>
              </div>
            </div>
          </div>
        </section>
      </div>
      <div id="tasks" class="tab-content">
        <section class="card">
          <h2>ğŸ—’ï¸ Tasks</h2>
          <div class="tasks-toolbar">
            <button id="tasks-save" class="btn btn-primary">Save</button>
            <button id="tasks-export" class="btn btn-secondary">Export to human_todo.mdc</button>
            <input id="tasks-filter" type="text" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰/FEAT-ID/ã‚«ãƒ†ã‚´ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿">
          </div>
          <div class="tasks-inputs">
            <div class="form-group">
              <label for="tasks-bulk">è¤‡æ•°è¡Œè²¼ã‚Šä»˜ã‘ï¼ˆ1è¡Œ=1ä»¶ã€ä¾‹: ã€æ©Ÿèƒ½æ”¹å–„ã€‘ã‚¿ã‚¤ãƒˆãƒ«ï¼‰</label>
              <textarea id="tasks-bulk" rows="4"></textarea>
            </div>
            <div class="control-group">
              <button id="tasks-bulk-import" class="btn btn-primary">å–ã‚Šè¾¼ã¿</button>
            </div>
            <hr/>
            <div class="form-group">
              <label>å˜ä¸€è¿½åŠ </label>
              <div class="control-group">
                <input id="tasks-add-category" type="text" placeholder="ã‚«ãƒ†ã‚´ãƒª">
                <input id="tasks-add-title" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
                <button id="tasks-add-one" class="btn btn-secondary">è¿½åŠ </button>
              </div>
            </div>
          </div>
          <div class="docs-split">
            <div class="docs-left">
              <h3>ã‚«ãƒ†ã‚´ãƒª</h3>
              <ul id="tasks-categories"></ul>
              <p class="empty-state" id="tasks-categories-empty">ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã™ã‚‹ã¨ã‚«ãƒ†ã‚´ãƒªãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
            <div class="docs-middle">
              <h3>ä¸€è¦§</h3>
              <ul id="tasks-list"></ul>
              <p class="empty-state" id="tasks-list-empty">ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>
            </div>
            <div class="docs-right">
              <h3>è©³ç´°</h3>
              <div id="task-detail" class="empty-state">ã‚¿ã‚¹ã‚¯ã‚’é¸æŠã™ã‚‹ã¨ç·¨é›†ã§ãã¾ã™</div>
            </div>
          </div>
        </section>
      </div>
      <div id="analytics" class="tab-content">
        <section class="card">
          <h2>ğŸ“ˆ Analytics Dashboard</h2>
          <p class="text-muted">DAGãƒ»ã‚¿ã‚¹ã‚¯ãƒ»Quality Gateã®æœ€æ–°çŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
          <div class="analytics-toolbar">
            <span id="analytics-status" class="status status-info">ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
            <div class="analytics-actions">
              <button id="analytics-refresh" class="btn btn-secondary">Refresh</button>
              <button id="analytics-export" class="btn btn-secondary">Export JSON</button>
            </div>
          </div>
          <div id="analytics-content" class="analytics-content hidden">
            <div class="analytics-grid">
              <div class="analytics-panel">
                <h3>ã‚¿ã‚¹ã‚¯é€²æ—</h3>
                <p id="analytics-progress-completion" class="analytics-highlight">0% å®Œäº† (0 / 0)</p>
                <div id="analytics-progress-chart"></div>
              </div>
              <div class="analytics-panel">
                <h3>DAGã‚µãƒãƒªãƒ¼</h3>
                <div id="analytics-dag-summary"></div>
              </div>
              <div class="analytics-panel">
                <h3>Quality Gatesã‚µãƒãƒªãƒ¼</h3>
                <div id="analytics-gate-summary"></div>
              </div>
            </div>
            <div class="analytics-grid analytics-grid--wide">
              <div class="analytics-panel">
                <h3>æ¬ æãƒãƒ¼ãƒ‰ä¸€è¦§</h3>
                <div id="analytics-missing-nodes"></div>
              </div>
              <div class="analytics-panel">
                <h3>Quality Gateæ¨ç§»</h3>
                <div id="analytics-gate-history"></div>
              </div>
            </div>
          </div>
        </section>
      </div>
      <div id="settings" class="tab-content">
        <section class="card">
          <h2>âš™ï¸ Settings</h2>
          <div class="settings-section">
            <h3>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ</h3>
            <div class="form-group">
              <label for="settings-project-root">Project Root Path</label>
              <input id="settings-project-root" type="text" placeholder="/path/to/project" />
            </div>
            <div class="control-group">
              <button id="settings-save-root" class="btn btn-primary">Save Project Root</button>
              <button id="settings-test-root" class="btn btn-secondary">Test Path</button>
              <span id="settings-project-root-status" class="status hidden"></span>
            </div>
            <div id="settings-test-results" class="settings-test-results"></div>
          </div>
          <hr />
          <div class="settings-section">
            <h3>Context File</h3>
            <p id="settings-context-path" class="settings-context-path">(æœªè¨­å®š)</p>
            <div class="control-group">
              <button id="settings-select-context" class="btn btn-secondary">Select Context File</button>
              <button id="settings-clear-context" class="btn btn-secondary">Clear</button>
              <span id="settings-context-status" class="status hidden"></span>
            </div>
            <p class="text-muted">å¤‰æ›´å¾Œã¯Docsã‚¿ãƒ–ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ï¼ˆãƒ„ãƒ¼ãƒ«ã‚’å†èµ·å‹•ã™ã‚‹ã¨ç¢ºå®Ÿã§ã™ï¼‰ã€‚</p>
          </div>
        </section>
      </div>
    </main>
  </div>
  <script>
    // Global error handler: log all errors to console instead of showing popup
    window.onerror = function(message, source, lineno, colno, error) {
      console.error('[Global Error Handler]', {
        message: message,
        source: source,
        line: lineno,
        col: colno,
        error: error,
        stack: error ? error.stack : 'N/A'
      });
      return true; // Prevent default error popup
    };
    
    window.addEventListener('unhandledrejection', function(event) {
      console.error('[Unhandled Promise Rejection]', event.reason);
    });
  </script>
  <script src="shared/app.js"></script>
  <script src="features/analytics/analytics.js"></script>
  <script src="features/docs-navigator/docs-navigator.js"></script>
  <script src="features/tasks/tasks.js"></script>
  <script src="features/settings/settings.js"></script>
</body>
</html>

