# 技術選定

> Breadcrumbs
> Layer: ARCH
> Upstream: docs/ARCH/index.mdc
> Downstream: N/A

## 要求の整理

### 核心要求

1. **ドキュメントトレーサビリティ**
   - 小分けドキュメントの自動管理
   - 双方向リンク維持（Upstream/Downstream）
   - DAG構造の可視化

2. **タスク分解支援**
   - Cursor AIへの指示定型化
   - プロンプト生成・履歴管理
   - Quality Gates検証

3. **ローカル完結**
   - 外部API不使用
   - オフライン動作
   - コストゼロ

## 技術選定の観点

### 必須要件

- デスクトップアプリケーション（UI）
- ファイルシステムアクセス
- ローカル完結（オフライン）
- DAG処理（グラフ構造の構築・検索）
- タスク管理UI

### オプション要件

- AI統合（将来）
- BI基盤（将来）
- 拡張性

## 候補技術比較

### パターン1: Electron + TypeScript（現行）

**選定理由**:
- デスクトップアプリに最適
- クロスプラットフォーム
- Node.js APIでファイルアクセス容易
- TypeScriptで型安全性確保

**デメリット**:
- メモリ使用量多い
- ビルドサイズ大きい
- 起動時間長い

**現行実装**:
- main.ts, preload.js, renderer/
- IPC通信
- context.mdc読み込み

### パターン2: Tauri + Rust/TypeScript

**選定理由（もし選ぶなら）**:
- メモリ使用量少ない（Electronより軽量）
- 起動時間速い
- ビルドサイズ小さい
- セキュリティ高い

**デメリット**:
- 技術スタック変更必要
- Rust/TypeScript混合
- コミュニティ小さい

### パターン3: Tauri + Svelte/Solid

**選定理由（もし選ぶなら）**:
- 超軽量
- 現代的UI
- ビルドサイズ非常に小さい

**デメリット**:
- 技術スタック大規模変更
- DAG処理ロジック再実装必要

### パターン4: PWA + Web技術

**選定理由（もし選ぶなら）**:
- ブラウザで動作
- クロスプラットフォーム
- メンテナンス容易

**デメリット**:
- ファイルアクセス制限（File System Access API）
- オフライン完結難しい
- セキュリティ制約多い

### パターン5: Python + Tkinter/Qt

**選定理由（もし選ぶなら）**:
- シンプルな実装
- データ処理向き
- ローカル完結

**デメリット**:
- UIが古い
- クロスプラットフォーム困難
- モダンな見た目実現困難

## 推奨: Electron + TypeScript（現行維持）

### 選定根拠

1. **デスクトップアプリ要求に最適**
   - ファイルシステムアクセス容易
   - オフライン完結可能
   - ネイティブ感のあるUI

2. **既存実装との整合性**
   - main.ts, preload.js, renderer/で構成済み
   - IPC通信実装済み
   - DAG処理ロジック実装済み

3. **TypeScriptのメリット**
   - 型安全性
   - 事前エラー検出
   - リファクタリング容易

4. **拡張性**
   - プラグインアーキテクチャ対応可
   - AI統合準備済み
   - E2Eテスト環境構築済み

### 軽量化の改善案

軽量化が必要な場合の改善策:

1. **ビルド最適化**
   - webpack設定調整
   - 不要な依存関係削除
   - Tree shaking

2. **起動時間短縮**
   - プリロード最適化
   - 遅延ロード
   - キャッシュ活用

3. **メモリ使用削減**
   - 仮想スクロール
   - データ遅延読み込み
   - メモリリーク対策

## 再評価: マルチプロジェクト対応の要件

### 追加要件

他のプロジェクトと併用する場合の追加要求:

1. **ワークスペース切替**
   - 複数プロジェクトのドキュメント管理
   - プロジェクト間の切り替え
   - 共通ドキュメントの再利用

2. **ファイルアクセス**
   - リポジトリ外のドキュメント読み込み
   - 複数リポジトリへのアクセス
   - 共通ライブラリへの参照

3. **パフォーマンス**
   - 常駐運用時の軽量性
   - 複数プロジェクトを開く場合のメモリ効率
   - バックグラウンド動作

### 影響

現行実装の問題点:

1. **リポジトリ外アクセス禁止**
   - 現行: リポジトリ外アクセスを禁止
   - 課題: 他のプロジェクトのドキュメントにアクセス不可

2. **ワークスペース管理なし**
   - 現行: 単一コンテキスト（Repo/Nexus）
   - 課題: 複数プロジェクト切り替え不可

3. **Electron起動コスト**
   - 現行: 起動毎に3秒
   - 課題: 頻繁な切り替えで非効率

## 推奨: Electron + TypeScript + 改善

### 選定根拠

1. **現在の要求を満たす**
   - デスクトップアプリ
   - ローカル完結
   - ファイルアクセス
   - DAG処理

2. **マルチプロジェクト対応の実現**
   - ワークスペース切替機能追加
   - リポジトリ外アクセス許可設定
   - キャッシュ管理強化

3. **常駐運用への対応**
   - システムトレイ常駐
   - バックグラウンド動作
   - メモリ効率化

### 改善が必要な点

1. **セキュリティ設定の柔軟化**
   - リポジトリ外アクセス許可設定
   - ホワイトリスト方式
   - ユーザー設定保存

2. **ワークスペース管理**
   - プロジェクト登録機能
   - 切り替え機能
   - 共通ドキュメント参照

3. **パフォーマンス改善**
   - システムトレイ常駐
   - 必要時のみ表示
   - キャッシュ活用

## 代替案の再評価

### Tauriを選ぶ理由（再考）

マルチプロジェクト対応が重要ならTauriも選択肢:

1. **軽量性**
   - 起動が速い（複数プロジェクト間の切り替えが速い）
   - メモリ使用が少ない（常駐運用に適している）

2. **セキュリティ**
   - Rustの安全性
   - パフォーマンスが高い

3. **クロスプラットフォーム**
   - Windows/macOS/Linux対応

**判断基準**:
- マルチプロジェクト対応が最優先 → Tauri
- 現行実装の活用を優先 → Electron + 改善

## 最終推奨

現状: **Electron + TypeScript + 改善案**

理由:
- 既存実装を活かせる
- マルチプロジェクト対応に必要な機能は実装可能
- 技術的リスクが少ない
- **AI支援コーディングとの親和性が高い**
  - TypeScriptはAIにとって最も理解しやすい言語の一つ
  - Electronは実装例が豊富（AIが参照しやすい）
  - GitHub Copilot/Cursorなどのサポートが充実
  - 開発効率が高い

移行を検討する条件:
- マルチプロジェクト対応でのパフォーマンス問題が発生
- Electronのメモリ使用が問題化
- 起動時間が頻繁な切り替えで支障

その際: Tauriへの移行を検討

### AI支援コーディングを考慮した理由

1. **TypeScriptのAI親和性**
   - 型情報が豊富でAIが推測しやすい
   - エディタの補完機能が充実
   - エラー検出が早い（AIの修正も速い）

2. **Electronの実績**
   - 実装例が豊富
   - ドキュメントが充実
   - AIが参照しやすいコードベースが多い

3. **開発効率**
   - Cursorとの統合が容易
   - GitHub Copilotのサポートが充実
   - 型安全性によりAIの修正が正確

### Tauriを選ばない理由

1. **AI支援コーディングの課題**
   - Rust言語はAIが理解しづらい
   - 実装例が少ない
   - エラー修正に時間がかかる可能性

2. **開発速度**
   - TypeScriptの方がAI支援が効きやすい
   - 実装速度が遅くなるリスク

3. **技術的リスク**
   - 技術スタックの大幅な変更
   - 既存コードの再実装コスト
   - 学習コスト

---

## 最終決定

### 選定技術: Electron + TypeScript

**決定日**: 2025-10-26

**決定理由**:
1. 既存実装の活用: main.ts, preload.js, renderer/で構成済み
2. AI支援コーディングとの親和性: TypeScript + ElectronはAI支援が効きやすい
3. 技術的リスクが低い: 実装例豊富、コミュニティ充実
4. マルチプロジェクト対応可能: ワークスペース切替機能追加で対応

**実装方針**:
- 現行のElectron + TypeScript構成を維持
- マルチプロジェクト対応機能を追加
- セキュリティ設定を柔軟化（リポジトリ外アクセス許可）
- システムトレイ常駐機能の追加（将来的）

**軽量化対策**:
- ビルド最適化（webpack設定調整）
- 起動時間短縮（プリロード最適化）
- メモリ使用削減（仮想スクロール、遅延読み込み）

**次のステップ**:
1. マルチプロジェクト対応の実装
2. ワークスペース切替機能の追加
3. セキュリティ設定の柔軟化

---

関連文書:
- ARCH/index.mdc: アーキテクチャ設計書一覧
- ARCH/システム概要.mdc: システム概要
- ARCH/システム構成.mdc: システム構成

